<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Drag & Drop Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>ðŸš— Car Price Dashboard</h1>
  </header>

  <main>
    <!-- Feature Auswahl -->
    <section id="features">
      {% for feature in features %}
        <div class="feature" draggable="true" data-feature="{{ feature }}">{{ feature }}</div>
      {% endfor %}
    </section>

    <!-- Plot Grid -->
    <section class="plot-grid">
      <div class="plot-card">
        <h2>Scatter vs Price</h2>
        <div class="dropzone" id="scatter"></div>
      </div>
      <div class="plot-card">
        <h2>Histogram</h2>
        <div class="dropzone" id="histogram"></div>
      </div>
      <div class="plot-card">
        <h2>Boxplot</h2>
        <div class="dropzone" id="boxplot"></div>
      </div>
    </section>

    <!-- Modelle -->
    <section class="models">
      <h2>Decision Tree & Random Forest</h2>
      <img src="{{ url_for('plot_tree_png') }}" alt="Trees" class="model-img">
      <h2>Vorhersagen auf Testdaten</h2>
      <img src="{{ url_for('plot_predictions') }}" alt="Predictions" class="model-img">
    </section>
  </main>

  <script>
    document.querySelectorAll('.feature').forEach(el => {
      el.addEventListener('dragstart', e => {
        e.dataTransfer.setData('feature', e.target.dataset.feature);
      });
    });

    document.querySelectorAll('.dropzone').forEach(zone => {
      zone.addEventListener('dragover', e => e.preventDefault());
      zone.addEventListener('drop', async e => {
        e.preventDefault();
        const feature = e.dataTransfer.getData('feature');
        const plotType = zone.id;

        zone.innerHTML = `<p>Lade ${feature} (${plotType})...</p>`;

        try {
          const response = await fetch(`/plot_image?feature=${encodeURIComponent(feature)}&plot_type=${encodeURIComponent(plotType)}`);
          if (!response.ok) {
            zone.innerHTML = `<p>Fehler: ${await response.text()}</p>`;
            return;
          }
          const blob = await response.blob();
          const url = URL.createObjectURL(blob);
          zone.innerHTML = `<img src="${url}" alt="${feature} ${plotType}" class="plot-img">`;
        } catch (err) {
          zone.innerHTML = `<p>Fehler beim Laden: ${err}</p>`;
        }
      });
    });
  </script>
</body>
</html>
